{
  "AltLookAngle": {
    "x": 0,
    "y": 0,
    "z": 0
  },
  "Autoraise": true,
  "ColorDiffuse": {
    "b": 1,
    "g": 1,
    "r": 1
  },
  "Description": "",
  "DragSelectable": true,
  "GMNotes": "",
  "GUID": "4825a7",
  "Grid": true,
  "GridProjection": false,
  "Hands": false,
  "HideWhenFaceDown": false,
  "IgnoreFoW": false,
  "LayoutGroupSortIndex": 0,
  "Locked": false,
  "LuaScript": "---\r\n--- Generated by Luanalysis\r\n--- Created by Whimsical.\r\n--- DateTime: 2021-12-19 5:00 p.m.\r\n---\r\n\r\n---@type table\u003cstring, string\u003e\r\nlocal token_ids = {\r\n  elder_sign = \"Elder Sign\",\r\n  skull = \"Skull\",\r\n  cultist = \"Cultist\",\r\n  tablet = \"Tablet\",\r\n  elder_thing = \"Elder Thing\",\r\n  autofail = \"Auto-fail\",\r\n  bless = \"Bless\",\r\n  curse = \"Curse\",\r\n  frost = \"Frost\",\r\n  unnamed = \"\"\r\n}\r\n\r\n---@type table\u003cstring, string\u003e\r\nlocal name_ids = {\r\n  [\"Elder Sign\"] = \"elder_sign\",\r\n  [\"Skull\"] = \"skull\",\r\n  [\"Cultist\"] = \"cultist\",\r\n  [\"Tablet\"] = \"tablet\",\r\n  [\"Elder Thing\"] = \"elder_thing\",\r\n  [\"Auto-fail\"] = \"autofail\",\r\n  [\"Bless\"] = \"bless\",\r\n  [\"Curse\"] = \"curse\",\r\n  [\"Frost\"] = \"frost\",\r\n  [\"\"] = \"unnamed\"\r\n}\r\n\r\n---@type Vector\r\nlocal rotation = {0, 270.00, 0}\r\n\r\n---@type table\u003cstring, number\u003e\r\nlocal offsets = {\r\n  x = -2,\r\n  z = -2\r\n}\r\n\r\nlocal left_right = \"z\"\r\nlocal up_down = \"x\"\r\nlocal vertical = \"y\"\r\n\r\n---@type TTSObject[]\r\nlocal tracking = {}\r\n\r\nfunction onload(data)\r\n  data = JSON.decode(data)\r\n  if data then\r\n    local existing = data.tracking\r\n\r\n    if existing then\r\n      for _, guid in ipairs(existing) do\r\n        local object = getObjectFromGUID(guid)\r\n        if object then\r\n          table.insert(tracking, object)\r\n        end\r\n      end\r\n    end\r\n\r\n    if data.tokens then\r\n      Wait.frames(function ()\r\n        for token, value in pairs(data.tokens) do\r\n          revalue(nil, value, token)\r\n        end\r\n      end, 3)\r\n    end\r\n\r\n    Wait.frames(function ()\r\n      if data.auto_update then\r\n        self.UI:setAttribute(\"auto_update\", \"isOn\", data.auto_update)\r\n        updateToggle(nil, data.auto_update, \"auto_update\")\r\n      end\r\n    end, 3)\r\n  end\r\n\r\n  self:addContextMenuItem(\"Clear\", function ()\r\n    tracking = {}\r\n  end, false)\r\nend\r\n\r\nfunction onSave()\r\n  local targets = {}\r\n  for _, token in ipairs(tracking) do\r\n    table.insert(targets, token:getGUID())\r\n  end\r\n\r\n  local tokens = {}\r\n  for id, _ in pairs(token_ids) do\r\n    tokens[id] = self.UI:getValue(id)\r\n  end\r\n\r\n  return JSON.encode({\r\n    tracking = targets,\r\n    tokens = tokens,\r\n    auto_update = self.UI:getAttribute(\"auto_update\", \"isOn\")\r\n  })\r\nend\r\n\r\n---@param player Player\r\n---@param value string\r\n---@param token string\r\nfunction revalue(player, value, token)\r\n  if not tonumber(value) then value = 0 end\r\n  self.UI:setValue(token, value)\r\n  self.UI:setAttribute(token, \"text\", value)\r\n\r\n  if player then -- player is nil when we call this in onload\r\n    -- False since \"on\" looks greyed out\r\n    if self.UI:getAttribute(\"auto_update\", \"isOn\"):lower()==\"false\" then\r\n      Wait.frames(function()\r\n        layout()\r\n      end, 3)\r\n    end\r\n  end\r\nend\r\n\r\n\r\n---@param player Player\r\n---@param token string\r\nfunction inc(player, token)\r\n  local value = tonumber(self.UI:getValue(token)) or 0\r\n  revalue(player, value+1, token)\r\nend\r\n\r\n---@param player Player\r\n---@param token string\r\nfunction dec(player, token)\r\n  local value = tonumber(self.UI:getValue(token)) or 0\r\n  revalue(player, value-1, token)\r\nend\r\n\r\n---@param player Player\r\n---@param value string\r\n---@param id string\r\nfunction updateToggle(player, value, id)\r\n  local value = value:lower() == \"true\" and true or false\r\n  self.UI:setAttribute(id, \"isOn\", value)\r\n  if player then\r\n    broadcastToAll(\"Token Arranger: Auto-Update \" .. (value and \"Disabled\" or \"Enabled\"))\r\n  end\r\nend\r\n\r\n---@return TTSObject\r\nlocal function get_chaos_bag()\r\n  return getObjectsWithTag(\"chaos_bag\")[1]\r\nend\r\n\r\n---@type table\u003cstring, number\u003e\r\nlocal token_precedence = {\r\n  [\"Skull\"] = -1,\r\n  [\"Cultist\"] = -2,\r\n  [\"Tablet\"] = -3,\r\n  [\"Elder Thing\"] = -4,\r\n\r\n  [\"Elder Sign\"] = 100,\r\n  [\"Auto-fail\"] = -100,\r\n\r\n  [\"Bless\"] = -1,\r\n  [\"Curse\"] = -2,\r\n  [\"Frost\"] = -3,\r\n  [\"\"] = -1000,\r\n}\r\n\r\nlocal function token_value_comparator(left, right)\r\n  if left.value\u003eright.value then return true\r\n  elseif right.value\u003eleft.value then return false\r\n  elseif left.precedence\u003eright.precedence then return true\r\n  elseif right.precedence\u003eleft.precedence then return false\r\n  else return left.token:getGUID() \u003e right.token:getGUID()\r\n  end\r\nend\r\n\r\nlocal function do_position()\r\n  local data = {}\r\n\r\n  for index, token in ipairs(tracking) do\r\n    local name = token:getName()\r\n\r\n    data[index] = {\r\n      token= token,\r\n      value = tonumber(name) or tonumber(self.UI:getValue(name_ids[name])),\r\n      precedence = token_precedence[name] or 0\r\n    }\r\n  end\r\n\r\n  table.sort(data, token_value_comparator)\r\n\r\n  local pos = self:getPosition()\r\n  local location = {}\r\n\r\n  pos[left_right] = pos[left_right] + offsets[left_right]\r\n\r\n  location[left_right] = pos[left_right]\r\n  location[up_down] = pos[up_down]\r\n  location[vertical] = pos[vertical]\r\n\r\n  local current_value = data[1].value\r\n\r\n  for _, item in ipairs(data) do\r\n    ---@type TTSObject\r\n    local token = item.token\r\n\r\n    ---@type number\r\n    local value = item.value\r\n\r\n    if value~=current_value then\r\n      location[left_right] = pos[left_right]\r\n      location[up_down] = location[up_down] + offsets[up_down]\r\n      current_value = value\r\n    end\r\n\r\n    token:setPosition(location)\r\n    token:setRotation(rotation)\r\n    location[left_right] = location[left_right] + offsets[left_right]\r\n  end\r\n\r\nend\r\n\r\nfunction layout()\r\n  for _, token in ipairs(tracking) do\r\n    token:destruct()\r\n  end\r\n\r\n  tracking = {}\r\n\r\n  local chaos_bag = get_chaos_bag()\r\n\r\n  local size = #chaos_bag:getObjects()\r\n\r\n  for _,data in ipairs(chaos_bag:getObjects()) do\r\n    chaos_bag:takeObject {\r\n      guid = data.guid,\r\n      smooth = false,\r\n      ---@param tok TTSObject\r\n      callback_function = function (tok)\r\n        local clone = tok:clone()\r\n        Wait.frames(function () chaos_bag:putObject(clone) end, 1)\r\n        table.insert(tracking, tok)\r\n      end\r\n    }\r\n  end\r\n\r\n  Wait.condition(function () do_position() end, function () return size==#tracking end)\r\nend\r\n",
  "LuaScriptState_path": "TokenArranger.4825a7.txt",
  "LuaScript_path": "TokenArranger.4825a7.ttslua",
  "MeasureMovement": false,
  "Name": "Checker_white",
  "Nickname": "Token Arranger",
  "Snap": true,
  "Sticky": true,
  "Tooltip": true,
  "Transform": {
    "posX": 28.6307545,
    "posY": 4.21900272,
    "posZ": -34.8876839,
    "rotX": 0.0828645453,
    "rotY": 89.99964,
    "rotZ": 359.9787,
    "scaleX": 1,
    "scaleY": 1,
    "scaleZ": 1
  },
  "Value": 0,
  "XmlUI": "    \u003cText alignment=\"MiddleRight\" width=\"100\" height=\"30\" color=\"#FFFFFF\" outline=\"#000000\" position=\"-140 -100 -5\" text=\"Elder Sign\" /\u003e\r\n    \u003cInputField id=\"elder_sign\" onEndEdit=\"revalue\" width=\"120\" height=\"30\" color=\"#FFFFFF\" position=\"-20 -100 -5\" characterValidation=\"Integer\"\u003e100\u003c/InputField\u003e\r\n    \u003cButton onClick=\"inc(elder_sign)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"60 -100 -5\" text=\"+\" /\u003e\r\n    \u003cButton onClick=\"dec(elder_sign)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"95 -100 -5\" text=\"-\" /\u003e\r\n\r\n    \u003cText alignment=\"MiddleRight\" width=\"100\" height=\"30\" color=\"#FFFFFF\" outline=\"#000000\" position=\"-140 -135 -5\" text=\"Skull\" /\u003e\r\n    \u003cInputField id=\"skull\" onEndEdit=\"revalue\" width=\"120\" height=\"30\" color=\"#FFFFFF\" position=\"-20 -135 -5\" characterValidation=\"Integer\"\u003e0\u003c/InputField\u003e\r\n    \u003cButton onClick=\"inc(skull)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"60 -135 -5\" text=\"+\" /\u003e\r\n    \u003cButton onClick=\"dec(skull)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"95 -135 -5\" text=\"-\" /\u003e\r\n\r\n    \u003cText alignment=\"MiddleRight\" width=\"100\" height=\"30\" color=\"#FFFFFF\" outline=\"#000000\" position=\"-140 -170 -5\" text=\"Cultist\" /\u003e\r\n    \u003cInputField id=\"cultist\" onEndEdit=\"revalue\" width=\"120\" height=\"30\" color=\"#FFFFFF\" position=\"-20 -170 -5\" characterValidation=\"Integer\"\u003e0\u003c/InputField\u003e\r\n    \u003cButton onClick=\"inc(cultist)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"60 -170 -5\" text=\"+\" /\u003e\r\n    \u003cButton onClick=\"dec(cultist)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"95 -170 -5\" text=\"-\" /\u003e\r\n\r\n    \u003cText alignment=\"MiddleRight\" width=\"100\" height=\"30\" color=\"#FFFFFF\" outline=\"#000000\" position=\"-140 -205 -5\" text=\"Tablet\" /\u003e\r\n    \u003cInputField id=\"tablet\" onEndEdit=\"revalue\" width=\"120\" height=\"30\" color=\"#FFFFFF\" position=\"-20 -205 -5\" characterValidation=\"Integer\"\u003e0\u003c/InputField\u003e\r\n    \u003cButton onClick=\"inc(tablet)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"60 -205 -5\" text=\"+\" /\u003e\r\n    \u003cButton onClick=\"dec(tablet)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"95 -205 -5\" text=\"-\" /\u003e\r\n\r\n    \u003cText alignment=\"MiddleRight\" width=\"100\" height=\"30\" color=\"#FFFFFF\" outline=\"#000000\" position=\"-140 -240 -5\" text=\"Elder Thing\" /\u003e\r\n    \u003cInputField id=\"elder_thing\" onEndEdit=\"revalue\" width=\"120\" height=\"30\" color=\"#FFFFFF\" position=\"-20 -240 -5\" characterValidation=\"Integer\"\u003e0\u003c/InputField\u003e\r\n    \u003cButton onClick=\"inc(elder_thing)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"60 -240 -5\" text=\"+\" /\u003e\r\n    \u003cButton onClick=\"dec(elder_thing)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"95 -240 -5\" text=\"-\" /\u003e\r\n\r\n    \u003cText alignment=\"MiddleRight\" width=\"100\" height=\"30\" color=\"#FFFFFF\" outline=\"#000000\" position=\"-140 -275 -5\" text=\"Auto-fail\" /\u003e\r\n    \u003cInputField id=\"autofail\" onEndEdit=\"revalue\" width=\"120\" height=\"30\" color=\"#FFFFFF\" position=\"-20 -275 -5\" characterValidation=\"Integer\"\u003e-100\u003c/InputField\u003e\r\n    \u003cButton onClick=\"inc(autofail)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"60 -275 -5\" text=\"+\" /\u003e\r\n    \u003cButton onClick=\"dec(autofail)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"95 -275 -5\" text=\"-\" /\u003e\r\n\r\n    \u003cText alignment=\"MiddleRight\" width=\"100\" height=\"30\" color=\"#FFFFFF\" outline=\"#000000\" position=\"-140 -310 -5\" text=\"Bless\" /\u003e\r\n    \u003cInputField id=\"bless\" onEndEdit=\"revalue\" width=\"120\" height=\"30\" color=\"#FFFFFF\" position=\"-20 -310 -5\" characterValidation=\"Integer\"\u003e-105\u003c/InputField\u003e\r\n    \u003cButton onClick=\"inc(bless)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"60 -310 -5\" text=\"+\" /\u003e\r\n    \u003cButton onClick=\"dec(bless)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"95 -310 -5\" text=\"-\" /\u003e\r\n\r\n    \u003cText alignment=\"MiddleRight\" width=\"100\" height=\"30\" color=\"#FFFFFF\" outline=\"#000000\" position=\"-140 -345 -5\" text=\"Curse\" /\u003e\r\n    \u003cInputField id=\"curse\" onEndEdit=\"revalue\" width=\"120\" height=\"30\" color=\"#FFFFFF\" position=\"-20 -345 -5\" characterValidation=\"Integer\"\u003e-106\u003c/InputField\u003e\r\n    \u003cButton onClick=\"inc(curse)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"60 -345 -5\" text=\"+\" /\u003e\r\n    \u003cButton onClick=\"dec(curse)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"95 -345 -5\" text=\"-\" /\u003e\r\n\r\n    \u003cText alignment=\"MiddleRight\" width=\"100\" height=\"30\" color=\"#FFFFFF\" outline=\"#000000\" position=\"-140 -380 -5\" text=\"Frost\" /\u003e\r\n    \u003cInputField id=\"frost\" onEndEdit=\"revalue\" width=\"120\" height=\"30\" color=\"#FFFFFF\" position=\"-20 -380 -5\" characterValidation=\"Integer\"\u003e-107\u003c/InputField\u003e\r\n    \u003cButton onClick=\"inc(frost)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"60 -380 -5\" text=\"+\" /\u003e\r\n    \u003cButton onClick=\"dec(frost)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"95 -380 -5\" text=\"-\" /\u003e\r\n\r\n    \u003cText alignment=\"MiddleRight\" width=\"100\" height=\"30\" color=\"#FFFFFF\" outline=\"#000000\" position=\"-140 -415 -5\" text=\"Unnamed\" /\u003e\r\n    \u003cInputField id=\"unnamed\" onEndEdit=\"revalue\" width=\"120\" height=\"30\" color=\"#FFFFFF\" position=\"-20 -415 -5\" characterValidation=\"Integer\"\u003e0\u003c/InputField\u003e\r\n    \u003cButton onClick=\"inc(unnamed)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"60 -415 -5\" text=\"+\" /\u003e\r\n    \u003cButton onClick=\"dec(unnamed)\" width=\"30\" height=\"30\" color=\"#FFFFFF\" position=\"95 -415 -5\" text=\"-\" /\u003e\r\n\r\n    \u003cButton alignment=\"MiddleCenter\" onClick=\"layout\" width=\"280\" height=\"30\" color=\"#000000\"  textColor=\"#FFFFFF\" position=\"-30 -450 -5\" text=\"Position Tokens\" /\u003e\r\n    \u003cToggleButton id=\"auto_update\" onValueChanged=\"updateToggle\" isOn=\"false\" width=\"280\" height=\"30\" position=\"-30 -485 -5\" text=\"Automatic Update\" /\u003e\r\n"
}